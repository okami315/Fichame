{% extends 'base.html.twig' %}

{% block title %}Eventos
{% endblock %}

{% block body %}
	{% set currentMonth = "now"|date('F Y') %}
	<div class="container-fluid">
		<div class="row justify-content-center mb-3">
			{% if is_granted('ROLE_ADMIN') %}
			<div class="col-12 col-md-2 pt-4">
					<div class="text-center">
						<a href="{{ path('app_event_new') }}" class="btn btn-primary mb-2">Crear nuevo evento</a>
						<a href="{{ path('app_type_new') }}" class="btn btn-primary mb-2">Crear tipo de evento</a>
						<a href="{{ path('app_user_event_index') }}" class="btn btn-primary mb-2">Lista de trabajadores</a>
					</div>
			</div>
			{% endif %}
			<div class="col-12 col-md-10">
				{% if is_granted('ROLE_ADMIN') %}
					{{dump(eventosPorMes)}}
					{% for mes, eventos in eventosPorMes %}
						{% if mes >= currentMonth %}
							<h2>{{ mes }}</h2>
							<div class="container">
								<div class="row justify-content-center align-items-center">
									{% for evento in eventos %}

										<div class="col-md-3">
											<div class="card mb-4">
												<div class="card-body">
													<h5 class="card-title">{{ evento.name }}</h5>
													<p class="card-text">Fecha comienzo
														<b>{{ evento.startDate|date('d-m-Y') }}</b>
													</p>
													<p class="card-text">Fecha fin
														<b>{{ evento.endDate|date('d-m-Y') }}</b>
													</p>

													{% if evento.status == 0 %}
														<p>ðŸŸ¡</p>
													{% elseif evento.status == 1 %}
														<p>ðŸ”´</p>
													{% else %}
														<p>ðŸŸ¢</p>
													{% endif %}

													<p class="card-text">NÃºmero de trabajadores:
														{{ evento.workersavailable }}
														de
														{{ evento.workersnumber }}</p>
													<div class="d-flex justify-content-around">
														<a class="btn btn-primary" href="{{ path('app_event_edit', {'id': evento.id}) }}">Editar</a>
														{% if evento.status == 0 and evento.userEvents|length  == 0 %}

															<form method="post" action="{{ path('app_event_delete', {'id': evento.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
																<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ evento.id) }}">
																<button class="btn btn-primary">Borrar</button>
															</form>
															<form method="post" action="{{ path('app_event_open_id', {'id': evento.id}) }}">
																<button class="btn btn-primary">Publicar evento</button>
															</form>
														{% endif %}
														{% if evento.status == 1 %}
															<form method="post" action="{{ path('app_event_close_id', {'id': evento.id}) }}">
																<button class="btn btn-primary mb-3">Cerrar evento</button>
															</form>
														{% endif %}
													</div>
												</div>
											</div>
										</div>

									{% endfor %}

								</div>
							</div>
						{% endif %}
					{% endfor %}

				{% else %}
						{% for mes, eventos in eventosPorMes %}
								<h2>{{ mes }}</h2>
							<div class="container">
								<div class="row justify-content-center align-items-center">
									{% for evento in eventos %}
										{% if evento.status != 0 %}
											<div class="col-md-3">
												<div class="card mb-4">
													<div class="card-body">
														<div class="row justify-content-center align-items-center">
													<h5 class="col-md-9 card-title">{{ evento.name }}</h5>
															
													{% if evento.type is not empty %}
														{% for type in evento.type %}
															<div class="col-md-3">
            													<img  src="{{ asset('images/' ~ type.icon) }}" alt="iconType" width="100%">
															</div>
														{% endfor %}
													{% endif %}
												</div>
												<p class="card-text">Fecha comienzo
															<b>{{ evento.startDate|date('d-m-Y') }}</b>
														</p>
														<p class="card-text">Fecha fin
															<b>{{ evento.endDate|date('d-m-Y') }}</b>
														</p>
														{% for userEvent in evento.userEvents %}
														<div class="row mx-1">															{# {% if userEvent.user == app.user %} #}

															{% if userEvent.disponibility is null %}
																<p>ðŸŸ¡</p>
															{% elseif userEvent.disponibility == 0 %}
																<p>âš«</p>
															{% elseif userEvent.selected is null %}
																<p>ðŸ”˜</p>
																{% if userEvent.coordination == 1 %}
																	<p>ðŸ—£</p>
																{% endif %}
																{% if userEvent.driving == 1 %}
																	<p>ðŸš•</p>
																{% endif %}
															{% else %}
																<p>ðŸŸ¢</p>
																{% if userEvent.coordination == 1 %}
																	<p>ðŸ—£</p>
																{% endif %}
																{% if userEvent.driving == 1 %}
																	<p>ðŸš•</p>
																{% endif %}
															{% endif %}
														
														</div>


															{% if userEvent.asistance is null %}
																<a href="{{ path('app_user_event_asistance', {'id': evento.id}) }}">Asistencia</a>
															{% endif %}

															{# {% endif %} #}

														{% endfor %}

														<p class="card-text">NÃºmero de trabajadores :
															{{evento.workersnumber}}</p>

														{# <p class="card-text">
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			<b>{{ evento.endDate|date('d-m-Y') }}</b>
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		</p> #}


														<a href="{{ path('app_user_event_disponibilidad', {'id': evento.id}) }}">Disponibilidad</a>

														{# Resto del contenido del evento #}
													</div>
												</div>
											</div>
										{% endif %}
									{% endfor %}
								</div>
							</div>
						{% endfor %}

				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
