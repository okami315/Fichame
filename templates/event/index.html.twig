{% extends 'base.html.twig' %}

{% block title %}Event index
{% endblock %}

{% block body %}
	{% set currentDate = "now"|date('U') %}
	{% set currentMonth = "now"|date('F') %}

	{% set lastMonth = null %}

	{% for event in events|filter(event => (event.startDate|date('U') > currentDate) or (event.endDate|date('U') >= currentDate)) %}
		{% set eventDate = event.startDate|date('U') %}
		{% set eventEndDate = event.endDate|date('U') %}
		{% set eventMonthEnd = event.endDate|date('F') %}
		{% set eventMonthStart = event.startDate|date('F') %}

		{# Verificar si el evento comienza antes pero termina despu√©s de la fecha actual #}
		{% if eventDate < currentDate and eventEndDate > currentDate %}
			{% set eventMonthStart = currentMonth %}
		{% endif %}

		{# Mostrar encabezado del mes si es diferente al mes anterior #}
		{% if eventMonthStart != lastMonth %}
			<h2>{{ eventMonthStart }}</h2>
			{% set lastMonth = eventMonthStart %}
		{% endif %}

		<div class="col-sm-6 col-md-4 col-lg-3">
			<div class="card mb-4">
				<div class="card-body">
					<h5 class="card-title">{{ event.name }}</h5>
					<p class="card-text">Fecha comienzo
						<b>{{ event.startDate|date('d-m-Y') }}</b>
					</p>
					<p class="card-text">Fecha fin
						<b>{{ event.endDate|date('d-m-Y') }}</b>
					</p>
						<a href="{{ path('app_user_event_disponibilidad', {'id': event.id}) }}">disponibilidad</a>
					{# Resto del contenido del evento #}
				</div>
			</div>
		</div>
	{% endfor %}

	{% if is_granted('ROLE_ADMIN') %}
		<div>
			<a href="{{ path('app_event_new') }}" class="btn btn-primary mx-auto">Crear nuevo evento</a>
		</div>
	{% endif %}
{% endblock %}
