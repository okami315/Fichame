{% extends 'base.html.twig' %}

{% block title %}Eventos
{% endblock %}

{% block body %}
	{% set currentMonth = "now"|date('F Y') %}
	<div class="container-fluid">
		<div class="row justify-content-center mb-3">
			{% if is_granted('ROLE_ADMIN') %}
				<div class="col-12 col-md-2 pt-4">
					<div class="text-center">
						<a href="{{ path('app_event_new') }}" class="btn btn-primary mb-2">Crear nuevo evento</a>
						<a href="{{ path('app_type_new') }}" class="btn btn-primary mb-2">Crear tipo de evento</a>
						<a href="{{ path('app_user_event_index') }}" class="btn btn-primary mb-2">Lista de trabajadores</a>
						<a href="{{ path('app_type_index') }}" class="btn btn-primary mb-2">Gestionar tipos</a>
					</div>
				</div>
			{% endif %}
			<div class="col-12 col-md-10">
				{% if is_granted('ROLE_ADMIN') %}
					{{dump(eventosPorMes)}}
					{% for mes, eventos in eventosPorMes %}
						{{dump(mes)}}
						{# {% if mes == currentMonth %} #}
						<h2>{{ mes }}</h2>
						<div class="container">
							<div class="row justify-content-center align-items-center">
								{% for evento in eventos %}
									<div class="col-md-3">
										<div class="card mb-4">
											<div class="card-body">
												<h5 class="card-title">{{ evento.name }}</h5>
												<div class="row justify-content-center align-items-center">
													{% if evento.type is not empty %}
														{% for type in evento.type %}
															<div class="col-3">
																<img src="{{ asset('images/' ~ type.icon) }}" alt="iconType" width="100%">
															</div>
														{% endfor %}
													{% endif %}
												</div>
												<p class="card-text text-center">Fecha comienzo
													<b>{{ evento.startDate|date('d-m-Y') }}</b>
												</p>
												<p class="card-text text-center">Fecha fin
													<b>{{ evento.endDate|date('d-m-Y') }}</b>
												</p>

												{% if evento.status == 0 %}
													<p class="text-center">ðŸŸ¡</p>
												{% elseif evento.status == 1 %}
													<p class="text-center">ðŸ”´</p>
												{% else %}
													<p class="text-center">ðŸŸ¢</p>
												{% endif %}

												<p class="card-text text-center">Horario estimado:
													{{ evento.schedule }}
												</p>
												{# 
																									<p class="card-text text-center">Horas estimadas:
																										
																										{{ evento.estimatedHours }}
																									</p>
																									<p class="card-text text-center">Horas reales:
																										{{ evento.realHours }}
																										
																									</p> 
																									<p class="card-text text-center">Sueldo estimado:
																										
																										{{ evento. }}
																									</p>
																									<p class="card-text text-center">Sueldo real:
																										{{ evento. }}		
																									</p> 
																									#}
												<p class="card-text text-center">NÂº trabajadores:
													{{ evento.workersavailable }}
													/
													{{ evento.workersnumber }}
												</p>
												<div class="row justify-content-center align-items-center">

													<a class="col-11 mb-2 btn btn-primary" href="{{ path('app_event_edit', {'id': evento.id}) }}">Editar</a>

													{% if evento.status == 0 and evento.userEvents|length  == 0 %}
														<div class="col-11 mb-2 px-0">
															<form class="m-0 mb-2" method="post" action="{{ path('app_event_delete', {'id': evento.id}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
																<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ evento.id) }}">
																<button class="btn btn-primary" style="width: 100%;">Borrar</button>
															</form>
															<form class="m-0" method="post" action="{{ path('app_event_open_id', {'id': evento.id}) }}">
																<button class="btn btn-primary" style="width: 100%;">Publicar evento</button>
															</form>
														</div>

													{% endif %}
													{% if evento.status == 1 %}
														<div class="col-11 px-0 ">
															<form class="m-0 mb-2" method="post" action="{{ path('app_event_close_id', {'id': evento.id}) }}">
																<button class="btn btn-primary" style="width: 100%;">Cerrar evento</button>
															</form>
														</div>
													{% endif %}

													<a class="col-11 mb-2 btn btn-primary" href="{{ path('app_user_event_show', {'id': evento.id}) }}">Lista de trabajadores</a>
												</div>
											</div>
										</div>
									</div>
								{% endfor %}
							</div>
						</div>
						{# {% endif %} #}
					{% endfor %}
				{% else %}
					{% for mes, eventos in eventosPorMes %}
						<h2>{{ mes }}</h2>
						<div class="container">
							<div class="row justify-content-center align-items-center">
								{% for evento in eventos %}
									{% if evento.status != 0 %}
										<div class="col-md-3">
											<div class="card mb-4">
												<div class="card-body">
													<h5 class="card-title">{{ evento.name }}</h5>
													<div class="row justify-content-center align-items-center">
														{% if evento.type is not empty %}
															{% for type in evento.type %}
																<div class="col-3">
																	<img src="{{ asset('images/' ~ type.icon) }}" alt="iconType" width="100%">
																</div>
															{% endfor %}
														{% endif %}
													</div>
													<p class="card-text text-center">Fecha comienzo
														<b>{{ evento.startDate|date('d-m-Y') }}</b>
													</p>
													<p class="card-text text-center">Fecha fin
														<b>{{ evento.endDate|date('d-m-Y') }}</b>
													</p>
													{% for userEvent in evento.userEvents %}

														{% if userEvent.user == app.user %}
															<div class="row justify-content-center mx-1">
																{% if userEvent.disponibility is null %}
																	<p>ðŸŸ¡</p>
																{% elseif userEvent.disponibility == 0 %}
																	<p>âš«</p>
																{% elseif userEvent.selected is null %}
																	<p>ðŸ”˜</p>
																	{% if userEvent.coordination == 1 %}
																		<p>ðŸ—£</p>
																	{% endif %}
																	{% if userEvent.driving == 1 %}
																		<p>ðŸš•</p>
																	{% endif %}
																{% else %}
																	<p>ðŸŸ¢</p>
																	{% if userEvent.coordination == 1 %}
																		<p>ðŸ—£</p>
																	{% endif %}
																	{% if userEvent.driving == 1 %}
																		<p>ðŸš•</p>
																	{% endif %}
																{% endif %}
															</div>

															<p class="card-text text-center">NÂº trabajadores:
																{{evento.workersnumber}}
															</p>

															{% if userEvent.asistance is null %}
															asistencia
																<select class="col-11 mb-2 form-select" id="asistance-select">
																	<option value="null">No marcado</option>
																	<option value="1">Asisto</option>
																	<option value="0">No asisto</option>
																</select>
															{% endif %}

														{% endif %}
													{% endfor %}

													<a class="col-11 mb-2 btn btn-primary" href="{{ path('app_user_event_disponibilidad', {'id': evento.id}) }}">Disponibilidad</a>
												</div>
											</div>
										</div>
									{% endif %}
								{% endfor %}
							</div>
						</div>
					{% endfor %}
				{% endif %}
			</div>
		</div>
	</div>


	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    $('#asistance-select').change(function() {
      var selectedValue = $(this).val();

      // Realizar acciones segÃºn el valor seleccionado
      switch (selectedValue) {
        case '0':
		console.log(selectedValue);
          // Acciones cuando se selecciona "No asisto"
          break;
        case '1':
		console.log(selectedValue);
          // Acciones cuando se selecciona "No marcado"
          break;
        default:
		console.log(selectedValue);
          // Acciones por defecto o para opciÃ³n "null"
          break;
      }
    });
  });
</script>
{% endblock %}


